/**
 * request-js - version 1.1.0
 * Request JS is a wrapper around XMLHttpRequest which simplifies its usage and makes it more readable.
 * Copyright 2016 by Philip Giuliani - info@philipg.net
 */
(function(){var a,b,c,d=[].slice,e=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};a=function(){function a(){this._callbacks={}}return a.prototype.on=function(a,b){var c;return(c=this._callbacks)[a]||(c[a]=[]),this._callbacks[a].push(b),this},a.prototype.off=function(a,b){var c,d;return(d=this._callbacks[a])?1===arguments.length?(delete this._callbacks[a],this):(c=d.indexOf(b._off||b),~c&&d.splice(c,1),this):this},a.prototype.emit=function(){var a,b,c,e,f,g,h;if(b=arguments[0],a=2<=arguments.length?d.call(arguments,1):[],e=this._callbacks[b])for(h=e.slice(0),f=0,g=h.length;g>f;f++)c=h[f],c.apply(this,a);return this},a}(),b={merge:function(a,b){var c,d;for(c in b)d=b[c],a[c]=d;return a},includeInto:function(a){var b,c,d,f;c=["extended","included","includeInto"];for(b in this)d=this[b],e.call(c,b)<0&&(a.prototype[b]=d);return null!=(f=a.included)&&f.apply(this),this}},this.Request=function(){function f(b){var c,d,f,g;for(null==b&&(b={}),this.response=null,this.canceled=!1,this._emitter=new a,this.xhr=null==b.cors||b.cors&&e.call(new XMLHttpRequest,"withCredentials")>=0?new XMLHttpRequest:new XDomainRequest,d=["before","success","error","complete","progress"],f=0,g=d.length;g>f;f++)c=d[f],"function"==typeof b[c]&&(this._emitter.on(c,b[c]),delete b[c]);this.merge(this,i),null!=b.form&&(this.url=b.form.action,this.method=b.form.method,this.data=new FormData(b.form)),this.merge(this,b)}var g,h,i,j,k;for(b.includeInto(f),i={url:null,method:"GET",async:!0,data:null,form:null,reviver:null},g=["GET","POST","PUT","DELETE"],f._addRequestMethod=function(a){return this[a]=function(b){return null==b&&(b={}),b.method=a,new f(b)}},j=0,k=g.length;k>j;j++)h=g[j],f._addRequestMethod(h);return f.prototype.send=function(){return this.xhr.addEventListener("progress",this._progressChange.bind(this)),this.xhr.addEventListener("readystatechange",this._stateChange.bind(this)),this.xhr.open(this.method,this.url,this.async,this.username,this.password),this._setRequestHeaders(),this._emitter.emit("before",this.xhr),this.xhr.send(this._requestData())},f.prototype.abort=function(){return this.canceled=!0,this.xhr.abort()},f.prototype.on=function(){return this._emitter.on.apply(this._emitter,arguments)},f.prototype.off=function(){return this._emitter.off.apply(this._emitter,arguments)},f.prototype.addEventListener=function(){return this._emitter.on.apply(this._emitter,arguments)},f.prototype.removeEventListener=function(){return this._emitter.off.apply(this._emitter,arguments)},f.prototype._setRequestHeaders=function(){return this._dataIsObject()?this.xhr.setRequestHeader("Content-Type","application/json;charset=UTF-8"):void 0},f.prototype._progressChange=function(){var a,b;return a=1<=arguments.length?d.call(arguments,0):[],(b=this._emitter).emit.apply(b,["progress"].concat(d.call(a)))},f.prototype._stateChange=function(){return this.xhr.readyState===XMLHttpRequest.DONE?(this.response=new c(this.xhr,{reviver:this.reviver}),this.response.success?this._emitter.emit("success",this.response):this._emitter.emit("error",this.response),this._emitter.emit("complete",this.response)):void 0},f.prototype._dataIsObject=function(){return this.data&&this.data.constructor===Object},f.prototype._requestData=function(){return this._dataIsObject()?JSON.stringify(this.data):this.data},f}(),c=function(){function a(a,b){this.xhr=a,null==b&&(b={}),this.status=this.xhr.status,this.data=this._parseResponse(b.reviver),this.success=this._wasSuccess(),this.rawData=this.xhr.responseText}return a.prototype._parseResponse=function(a){try{return JSON.parse(this.xhr.responseText,a)}catch(b){return this.xhr.responseText}},a.prototype._wasSuccess=function(){var a,b,c;return b=this.status,e.call(function(){for(c=[],a=200;299>=a;a++)c.push(a);return c}.apply(this),b)>=0},a}(),this.RequestQueue=function(){function c(b){this.workerCount=null!=b?b:1,this.jobs=[],this.runningJobs=[],this._emitter=new a}return b.includeInto(c),c.LOW=0,c.NORMAL=1,c.HIGH=2,c.VERY_HIGH=3,c.prototype.enqueue=function(a){return this.jobs.push(a),this._emitter.emit("enqueue",a),this._checkQueue(),a},c.prototype.on=function(){return this._emitter.on.apply(this._emitter,arguments)},c.prototype.off=function(){return this._emitter.off.apply(this._emitter,arguments)},c.prototype._checkQueue=function(){var a,b;if(!(this.runningJobs.length>=this.workerCount)){for(b=[];this.jobs.length>0&&this.runningJobs.length<this.workerCount;)a=this._dequeue(),b.push(this._startJob(a));return b}},c.prototype._dequeue=function(){var a,b;return 0===this.jobs.length?null:(b=this.jobs.slice(0).sort(function(a,b){return b.priority-a.priority}),a=b.shift(),this._removeJob(a),a)},c.prototype._startJob=function(a){return this._emitter.emit("start",a),this.runningJobs.push(a),a.run(this._jobComplete.bind(this))},c.prototype._removeJob=function(a){var b;return b=this.jobs.indexOf(a),b>-1?(this.jobs.splice(b,1),!0):!1},c.prototype._jobComplete=function(a){var b;return this._emitter.emit("finish",a),b=this.runningJobs.indexOf(a),this.runningJobs.splice(b,1),this._checkQueue()},c}(),this.RequestJob=function(){function a(a,b){this.request=a,this.priority=null!=b?b:RequestQueue.NORMAL}return a.prototype.run=function(a){return this.request.on("complete",a.bind(this)),this.request.async=!0,this.request.send()},a}()}).call(this);